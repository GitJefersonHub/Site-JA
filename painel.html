<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Painel do Usu√°rio</title>
  <link rel="stylesheet" href="css/painel.css">
</head>

<body>

  <script>
    // Prote√ß√£o contra acesso direto sem login
    if (localStorage.getItem('usuarioLogado') !== 'true') {
      alert('Acesso n√£o autorizado. Fa√ßa login para continuar.');
      location.replace('login.html');
    }

    // Carrega dados do usu√°rio logado
    const dados = JSON.parse(localStorage.getItem('dadosUsuario'));

    if (!dados || !dados.nome || !dados.matricula || !dados.telefone || !dados.email || !dados.senha) {
      alert('Dados de usu√°rio inv√°lidos. Fa√ßa login novamente.');
      localStorage.removeItem('usuarioLogado');
      localStorage.removeItem('dadosUsuario');
      location.replace('login.html');
    }

    // Sauda√ß√£o com base no hor√°rio
    function gerarSaudacao(nome) {
      const hora = new Date().getHours();
      let saudacao = 'Ol√°';

      if (hora >= 5 && hora < 12) {
        saudacao = 'Bom dia';
      } else if (hora >= 12 && hora < 18) {
        saudacao = 'Boa tarde';
      } else {
        saudacao = 'Boa noite';
      }

      return `${saudacao}, ${nome}!`;
    }
  </script>

  <div class="painel-container">
    <h2 id="boasVindas"></h2>
    <div class="info" id="infoNome">üìå Nome: </div>
    <div class="info" id="infoMatricula">üìå Matr√≠cula: </div>
    <div class="info" id="infoTelefone">üìû Telefone: </div>
    <div class="info" id="infoEmail">üìß E-mail: </div>
    <p class="lembrete">üîê Lembre-se: Guarde suas informa√ß√µes de login.</p>

    <div class="actions">
      <button class="btn-relatorios" onclick="acessarRelatorios()">Relat√≥rios</button>
      <button class="btn-visualizar" onclick="mostrarDados()">Visualizar Perfil</button>
      <button class="btn-editar" onclick="editarPerfil()">Editar Perfil</button>


      <div id="formCadastro" style="display: none; flex-direction: column; gap: 10px; margin-top: 20px;">
        <label>Nome:</label>
        <input type="text" id="cadNome">

        <label>Matr√≠cula:</label>
        <input type="text" id="cadMatricula" maxlength="6">

        <label>Telefone:</label>
        <input type="tel" id="cadTelefone" placeholder="(99) 99999-9999">

        <label>E-mail:</label>
        <input type="email" id="cadEmail">

        <label>Senha:</label>
        <input type="password" id="cadSenha" maxlength="6">

        <button onclick="salvarNovoUsuario()">Enviar</button>
      </div>

      <div id="formEditar">
        <label>Nome:</label>
        <input type="text" id="editNome">

        <label>Matr√≠cula:</label>
        <input type="text" id="editMatricula">

        <label>Telefone:</label>
        <input type="tel" id="editTelefone" placeholder="(99) 99999-9999">

        <label>E-mail:</label>
        <input type="email" id="editEmail">

        <label>Senha:</label>
        <div style="position: relative; display: flex; align-items: center;">
          <input type="password" id="editSenha" maxlength="6" style="flex: 1; padding-right: 15%;">
          <span id="toggleIcon" onclick="toggleSenha()" style="
            position: absolute;
            right: 4%;
            top: 50%;
            transform: translateY(-50%);
            font-size: 400%;
            cursor: pointer;
            color: #007bff;
            user-select: none;
          ">üëÅÔ∏è</span>
        </div>
        <button class="btn-salvar" onclick="salvarPerfil()">Salvar Altera√ß√µes</button>
      </div>
      <button class="btn-sair" onclick="sair()">Sair</button>
    </div>
    <button class="btn-lista" onclick="imprimirLista()">Lista</button>
    <button class="btn-excluir" onclick="excluir()">Excluir Cadastro</button>
  </div>

  <script>
    // Exibe sauda√ß√£o e dados
    document.getElementById('boasVindas').textContent = gerarSaudacao(dados.nome);
    document.getElementById('infoNome').textContent = `üìå Nome: ${dados.nome}`;
    document.getElementById('infoMatricula').textContent = `üìå Matr√≠cula: ${dados.matricula}`;
    document.getElementById('infoTelefone').textContent = `üìû Telefone: ${dados.telefone}`;
    document.getElementById('infoEmail').textContent = `üìß E-mail: ${dados.email}`;

    function toggleSenha() {
      const senhaInput = document.getElementById('editSenha');
      const toggleIcon = document.getElementById('toggleIcon');
      if (senhaInput.type === 'password') {
        senhaInput.type = 'text';
        toggleIcon.textContent = 'üôà';
      } else {
        senhaInput.type = 'password';
        toggleIcon.textContent = 'üëÅÔ∏è';
      }
    }

    function imprimirLista() {
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];

      if (usuarios.length === 0) {
        alert('Nenhum usu√°rio cadastrado para imprimir.');
        return;
      }

      let printContent = '<h2>Lista de Usu√°rios</h2><ul style="list-style:none;">';
      usuarios.forEach((user, index) => {
        printContent += `
      <li style="margin-bottom: 15px;">
        <strong>${index + 1}. ${user.nome}</strong><br>
        Matr√≠cula: ${user.matricula}<br>
        Telefone: ${user.telefone}<br>
        E-mail: ${user.email}
      </li>
    `;
      });
      printContent += '</ul>';

      const printWindow = window.open('', '', 'width=800,height=600');
      printWindow.document.write(`
    <html>
      <head>
        <title>Impress√£o da Lista</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          h2 { text-align: center; }
        </style>
      </head>
      <body>${printContent}</body>
    </html>
  `);
      printWindow.document.close();
      printWindow.focus();
      printWindow.print();
    }

    function salvarPerfil() {
      const novoNome = document.getElementById('editNome').value.trim();
      const novaMatricula = document.getElementById('editMatricula').value.trim();
      const novoTelefone = document.getElementById('editTelefone').value.trim();
      const novoEmail = document.getElementById('editEmail').value.trim();
      const novaSenha = document.getElementById('editSenha').value.trim();

      if (!novoNome || !novaMatricula || !novoTelefone || !novoEmail || !novaSenha) {
        alert('Todos os campos devem ser preenchidos.');
        return;
      }

      const novosDados = {
        nome: novoNome,
        matricula: novaMatricula,
        telefone: novoTelefone,
        email: novoEmail,
        senha: novaSenha
      };

      localStorage.setItem('dadosUsuario', JSON.stringify(novosDados));
      alert('Perfil atualizado com sucesso!\n\nVoc√™ ser√° desconectado para fazer login novamente com os novos dados.');
      localStorage.removeItem('usuarioLogado');
      location.replace('login.html');
    }
  </script>

  <script src="js/painel/relatorios.js"></script>
  <script src="js/painel/visualizarPerfil.js"></script>
  <script src="js/painel/editarPerfil.js"></script>
  <script src="js/painel/sair.js"></script>
</body>

</html>